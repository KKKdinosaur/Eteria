<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>에테리아 모듈 판매 체크</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; background: #fafafa; padding: 20px; line-height: 1.5; color: #333; }
        .container { max-width: 1400px; margin: 0 auto; }
        header { background: white; padding: 20px; border-radius: 8px; margin-bottom: 20px; box-shadow: 0 1px 3px rgba(0,0,0,0.1); }
        h1 { font-size: 1.5em; color: #2c3e50; margin-bottom: 12px; }
        .editor-section { background: white; padding: 20px; border-radius: 8px; margin-bottom: 20px; box-shadow: 0 1px 3px rgba(0,0,0,0.1); }
        .editor-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px; flex-wrap: wrap; gap: 10px; }
        .editor-header h2 { font-size: 1.2em; color: #2c3e50; }
        .editor-controls { display: flex; gap: 10px; align-items: center; flex-wrap: wrap; }
        select { padding: 8px 12px; border: 1px solid #e0e0e0; border-radius: 4px; background: white; font-size: 0.9em; cursor: pointer; min-width: 150px; }
        textarea { width: 100%; min-height: 250px; padding: 12px; border: 1px solid #e0e0e0; border-radius: 4px; font-family: 'Courier New', monospace; font-size: 0.85em; resize: vertical; }
        .btn { padding: 8px 16px; border: none; border-radius: 4px; cursor: pointer; font-size: 0.9em; font-weight: 500; }
        .btn-primary { background: #2196F3; color: white; }
        .btn-success { background: #4CAF50; color: white; }
        .btn-danger { background: #f44336; color: white; }
        .notice { background: #fff3cd; border: 1px solid #ffeeba; color: #856404; padding: 12px; border-radius: 4px; margin-top: 12px; font-size: 0.85em; }
        .add-btn { background: #2196F3; color: white; border: none; padding: 12px 24px; border-radius: 4px; cursor: pointer; font-size: 1em; font-weight: 500; margin-bottom: 20px; }
        .module-card { background: white; border-radius: 8px; padding: 20px; margin-bottom: 15px; box-shadow: 0 1px 3px rgba(0,0,0,0.1); border-left: 4px solid #e0e0e0; }
        .module-card.keep { border-left-color: #4CAF50; }
        .module-card.sell { border-left-color: #f44336; }
        .module-card.empty { border-left-color: #9E9E9E; }
        .module-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px; gap: 15px; flex-wrap: wrap; }
        .module-info { display: flex; gap: 10px; align-items: flex-end; flex-wrap: wrap; }
        .select-wrapper { display: flex; flex-direction: column; }
        .select-label { font-size: 0.75em; color: #7f8c8d; margin-bottom: 4px; }
        .status-badge { padding: 6px 12px; border-radius: 4px; font-size: 0.85em; font-weight: 600; }
        .status-badge.keep { background: #E8F5E9; color: #2E7D32; }
        .status-badge.sell { background: #FFEBEE; color: #C62828; }
        .status-badge.empty { background: #F5F5F5; color: #616161; }
        .remove-btn { background: white; color: #f44336; border: 1px solid #f44336; padding: 6px 12px; border-radius: 4px; cursor: pointer; font-size: 0.85em; }
        .main-stat-info { background: #f5f5f5; padding: 12px; border-radius: 4px; font-size: 0.95em; font-weight: 600; color: #333; margin-bottom: 15px; border-left: 4px solid #2196F3; }
        .substats-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(120px, 1fr)); gap: 8px; }
        .substat-btn { padding: 10px; border: 2px solid #e0e0e0; border-radius: 4px; cursor: pointer; text-align: center; font-size: 0.85em; background: white; }
        .substat-btn.good { border-color: #4CAF50; background: #F1F8E9; }
        .substat-btn.good.selected { background: #4CAF50; color: white; }
        .substat-btn.bad.selected { background: #757575; color: white; }
        .substat-btn:disabled { opacity: 0.5; cursor: not-allowed; }
        .substat-btn.hidden { display: none; }
        .empty-state { text-align: center; padding: 60px 20px; color: #95a5a6; background: white; border-radius: 8px; }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>에테리아 모듈 판매 체크</h1>
        </header>

        <div class="editor-section">
            <div class="editor-header">
                <h2>세트별 유효옵션 편집</h2>
                <div class="editor-controls">
                    <select id="set-selector"></select>
                    <button class="btn btn-primary" onclick="loadSetData()">불러오기</button>
                    <button class="btn btn-success" onclick="saveSetData()">저장</button>
                    <button class="btn btn-danger" onclick="resetSetData()">초기화</button>
                </div>
            </div>
            <textarea id="set-editor"></textarea>
            <div class="notice">
                <strong>사용법:</strong> 세트 선택 → JSON 편집 → 저장 클릭
            </div>
        </div>

        <button class="add-btn" onclick="addModule()">+ 모듈 추가</button>
        <div id="modules-container"></div>
    </div>

    <script>
        const sets = [
            { name: '공세', type: 12, color: '#f44336' },
            { name: '원천', type: 12, color: '#4CAF50' },
            { name: '강철', type: 12, color: '#FFC107' },
            { name: '질주', type: 12, color: '#2196F3' },
            { name: '수호', type: 12, color: '#9C27B0' },
            { name: '전의', type: 12, color: '#E91E63' },
            { name: '자기', type: 8, color: '#FFC107' },
            { name: '치유', type: 8, color: '#4CAF50' },
            { name: '진격', type: 8, color: '#2196F3' },
            { name: '처단', type: 8, color: '#f44336' },
            { name: '광폭', type: 8, color: '#f44336' },
            { name: '기세 추격', type: 12, color: '#f44336' },
            { name: '유혈 사태', type: 8, color: '#FFC107' },
            { name: '시공 지배', type: 12, color: '#2196F3' },
            { name: '통찰', type: 12, color: '#f44336' },
            { name: '폭렬 칼날', type: 8, color: '#f44336' },
            { name: '역병', type: 8, color: '#9C27B0' },
            { name: '철벽', type: 8, color: '#FFC107' },
            { name: '급습 공격', type: 8, color: '#2196F3' },
            { name: '섬광 타격', type: 8, color: '#9C27B0' },
            { name: '진화 보호', type: 8, color: '#4CAF50' }
        ];

        const originalGoodStats = {
            '공세': {
                '마스크': ['공격력%', '속도', '치명타 확률', '치명타 피해', '효과 명중'],
                '트랜지스터': ['HP%', '깡공', '속도', '치명타 확률', '치명타 피해'],
                '반지': ['깡공', '속도', '치명타 확률', '효과 명중'],
                '코어': {
                    '공격력%': ['깡공', '속도', '치명타 확률', '치명타 피해', '효과 명중'],
                    'default': ['깡공', '속도']
                }
            },
            '원천': {
                '마스크': ['깡체', '속도', '효과 명중'],
                '트랜지스터': ['HP%', '속도', '효과 저항'],
                '반지': ['깡체', '속도', '효과 명중', '효과 저항'],
                '코어': {
                    'HP%': ['깡체', '방어력%', '속도', '효과 명중', '효과 저항'],
                    '방어력%': ['깡체', 'HP%', '속도', '효과 명중', '효과 저항'],
                    'default': ['깡체', 'HP%', '속도']
                }
            },
            '강철': {
                '마스크': ['깡체', '속도', '효과 명중'],
                '트랜지스터': ['HP%', '속도'],
                '반지': ['깡체', '방어력%', '속도', '효과 명중'],
                '코어': {
                    '방어력%': ['깡체', 'HP%', '깡방', '속도', '효과 명중'],
                    'HP%': ['깡체', '깡방', '방어력%', '속도', '효과 명중'],
                    'default': ['깡체', 'HP%', '속도']
                }
            },
            '질주': {
                '마스크': ['깡체', '속도', '효과 명중'],
                '트랜지스터': ['HP%', '속도'],
                '반지': ['깡체', '속도', '효과 명중'],
                '코어': {
                    '공격력%': ['HP%', '속도', '치명타 확률', '치명타 피해', '효과 명중'],
                    'default': ['깡체', 'HP%', '속도']
                }
            },
            '수호': {
                '마스크': ['깡체', '속도', '효과 명중'],
                '트랜지스터': ['HP%', '속도', '효과 저항'],
                '반지': ['깡체', '방어력%', '속도', '효과 저항'],
                '코어': {
                    'HP%': ['깡체', '깡방', '방어력%', '속도', '효과 저항'],
                    '방어력%': ['깡체', 'HP%', '깡방', '속도', '효과 저항'],
                    'default': ['깡체', 'HP%', '속도']
                }
            },
            '전의': {
                '마스크': ['깡체', '공격력%', '속도', '치명타 확률', '치명타 피해'],
                '트랜지스터': ['HP%', '깡공', '속도', '치명타 확률', '치명타 피해'],
                '반지': ['깡체', '깡공', '속도', '치명타 확률'],
                '코어': {
                    '공격력%': ['깡체', 'HP%', '깡공', '속도', '치명타 확률', '치명타 피해'],
                    'HP%': ['깡체', '깡공', '공격력%', '속도', '치명타 확률', '치명타 피해'],
                    'default': ['깡체', 'HP%', '속도']
                }
            },
            '자기': {
                '마스크': ['깡체', '속도', '효과 명중'],
                '트랜지스터': ['HP%', '속도'],
                '반지': ['깡체', '방어력%', '속도', '효과 명중'],
                '코어': {
                    '방어력%': ['깡체', 'HP%', '깡방', '속도', '효과 명중'],
                    'HP%': ['깡체', '깡방', '방어력%', '속도', '효과 명중'],
                    'default': ['깡체', 'HP%', '속도']
                }
            },
            '치유': {
                '마스크': ['깡체', '속도'],
                '트랜지스터': ['HP%', '속도'],
                '반지': ['깡체', '방어력%', '속도'],
                '코어': {
                    'HP%': ['깡체', '깡방', '방어력%', '속도'],
                    '방어력%': ['깡체', 'HP%', '깡방', '속도'],
                    'default': ['깡체', 'HP%', '속도']
                }
            },
            '진격': {
                '마스크': ['깡체', '속도'],
                '트랜지스터': ['HP%', '속도'],
                '반지': ['깡체', '방어력%', '속도'],
                '코어': {
                    'HP%': ['깡체', '깡방', '방어력%', '속도'],
                    '방어력%': ['깡체', 'HP%', '깡방', '속도'],
                    'default': ['깡체', 'HP%', '속도']
                }
            },
            '처단': {
                '마스크': ['깡체', '공격력%', '속도', '치명타 확률', '치명타 피해'],
                '트랜지스터': ['HP%', '깡공', '속도', '치명타 확률', '치명타 피해'],
                '반지': ['깡체', '깡공', '속도', '치명타 확률'],
                '코어': {
                    '공격력%': ['깡체', 'HP%', '깡공', '속도', '치명타 확률', '치명타 피해'],
                    'HP%': ['깡체', '깡공', '공격력%', '속도', '치명타 확률', '치명타 피해'],
                    'default': ['깡체', 'HP%', '속도']
                }
            },
            '광폭': {
                '마스크': ['깡체', '공격력%', '속도', '치명타 확률', '치명타 피해'],
                '트랜지스터': ['HP%', '깡공', '속도', '치명타 확률', '치명타 피해'],
                '반지': ['깡체', '깡공', '속도', '치명타 확률'],
                '코어': {
                    '공격력%': ['깡체', 'HP%', '깡공', '속도', '치명타 확률', '치명타 피해'],
                    'HP%': ['깡체', '깡공', '공격력%', '속도', '치명타 확률', '치명타 피해'],
                    'default': ['깡체', 'HP%', '속도']
                }
            },
            '기세 추격': {
                '마스크': ['깡체', '공격력%', '속도', '치명타 확률', '치명타 피해', '효과 명중'],
                '트랜지스터': ['HP%', '깡공', '속도', '치명타 확률', '치명타 피해'],
                '반지': ['깡체', '깡공', '속도', '치명타 확률', '효과 명중'],
                '코어': {
                    '공격력%': ['깡체', 'HP%', '깡공', '속도', '치명타 확률', '치명타 피해', '효과 명중'],
                    'HP%': ['깡체', '깡공', '공격력%', '속도', '치명타 확률', '치명타 피해', '효과 명중'],
                    'default': ['깡체', 'HP%', '속도']
                }
            },
            '유혈 사태': {
                '마스크': ['깡체', '공격력%', '속도', '치명타 확률', '치명타 피해'],
                '트랜지스터': ['HP%', '깡공', '속도', '치명타 확률', '치명타 피해'],
                '반지': ['깡체', '깡공', '속도', '치명타 확률'],
                '코어': {
                    '공격력%': ['깡체', 'HP%', '깡공', '속도', '치명타 확률', '치명타 피해'],
                    'HP%': ['깡체', '깡공', '공격력%', '속도', '치명타 확률', '치명타 피해'],
                    'default': ['깡체', 'HP%', '속도']
                }
            },
            '시공 지배': {
                '마스크': ['깡체', '속도', '효과 명중'],
                '트랜지스터': ['HP%', '속도'],
                '반지': ['깡체', '속도', '효과 명중'],
                '코어': {
                    '치명타 피해': ['깡체', 'HP%', '속도', '효과 명중'],
                    'HP%': ['깡체', '속도', '치명타 피해', '효과 명중'],
                    'default': ['깡체', 'HP%', '속도']
                }
            },
            '통찰': {
                '마스크': ['깡체', '공격력%', '속도', '치명타 확률', '치명타 피해'],
                '트랜지스터': ['HP%', '깡공', '속도', '치명타 확률', '치명타 피해'],
                '반지': ['깡체', '깡공', '속도', '치명타 확률'],
                '코어': {
                    '공격력%': ['깡공', '속도', '치명타 확률', '치명타 피해'],
                    '치명타 확률': ['깡공', '공격력%', '속도', '치명타 피해'],
                    '치명타 피해': ['깡공', '공격력%', '속도', '치명타 확률'],
                    'default': ['깡공', '속도']
                }
            },
            '폭렬 칼날': {
                '마스크': ['깡체', '공격력%', '속도', '치명타 확률', '효과 명중'],
                '트랜지스터': ['HP%', '깡공', '속도', '치명타 확률'],
                '반지': ['깡체', '깡공', '속도', '치명타 확률', '효과 명중'],
                '코어': {
                    '공격력%': ['깡체', 'HP%', '깡공', '속도', '치명타 확률', '효과 명중'],
                    'HP%': ['깡체', '깡공', '공격력%', '속도', '치명타 확률', '효과 명중'],
                    'default': ['깡체', 'HP%', '속도']
                }
            },
            '역병': {
                '마스크': ['깡체', '속도', '효과 명중'],
                '트랜지스터': ['HP%', '속도'],
                '반지': ['깡체', '속도', '효과 명중'],
                '코어': {
                    'HP%': ['깡체', '속도', '효과 명중'],
                    '효과 명중': ['깡체', 'HP%', '속도'],
                    'default': ['깡체', 'HP%', '속도']
                }
            },
            '철벽': {
                '마스크': ['깡체', '속도'],
                '트랜지스터': ['HP%', '속도', '효과 저항'],
                '반지': ['깡체', '방어력%', '속도', '효과 저항'],
                '코어': {
                    '방어력%': ['깡체', 'HP%', '깡방', '속도', '효과 저항'],
                    'HP%': ['깡체', '깡방', '방어력%', '속도', '효과 저항'],
                    'default': ['깡체', 'HP%', '속도']
                }
            },
            '급습 공격': {
                '마스크': ['깡체', '공격력%', '속도', '치명타 확률'],
                '트랜지스터': ['HP%', '깡공', '속도', '치명타 확률'],
                '반지': ['깡체', '깡공', '속도', '치명타 확률'],
                '코어': {
                    '공격력%': ['깡체', 'HP%', '깡공', '속도', '치명타 확률'],
                    'HP%': ['깡체', '깡공', '공격력%', '속도', '치명타 확률'],
                    'default': ['깡체', 'HP%', '속도']
                }
            },
            '섬광 타격': {
                '마스크': ['깡체', '속도', '효과 명중'],
                '트랜지스터': ['HP%', '속도'],
                '반지': ['깡체', '속도', '효과 명중'],
                '코어': {
                    '방어력%': ['깡체', 'HP%', '속도', '효과 명중'],
                    'HP%': ['깡체', '방어력%', '속도', '효과 명중'],
                    'default': ['깡체', 'HP%', '속도']
                }
            },
            '진화 보호': {
                '마스크': ['깡체', '속도'],
                '트랜지스터': ['HP%', '속도'],
                '반지': ['깡체', '방어력%', '속도'],
                '코어': {
                    'HP%': ['깡체', '깡방', '방어력%', '속도'],
                    '방어력%': ['깡체', 'HP%', '깡방', '속도'],
                    'default': ['깡체', 'HP%', '속도']
                }
            }
        };

        let goodStats = JSON.parse(JSON.stringify(originalGoodStats));
        let modules = [];
        let nextId = 1;

        function initEditor() {
            const selector = document.getElementById('set-selector');
            Object.keys(goodStats).forEach(setName => {
                const option = document.createElement('option');
                option.value = setName;
                option.textContent = setName;
                selector.appendChild(option);
            });
            loadSetData();
        }

        function loadSetData() {
            const setName = document.getElementById('set-selector').value;
            document.getElementById('set-editor').value = JSON.stringify(goodStats[setName], null, 2);
        }

        function saveSetData() {
            const setName = document.getElementById('set-selector').value;
            try {
                goodStats[setName] = JSON.parse(document.getElementById('set-editor').value);
                alert('저장 완료!');
                renderModules();
            } catch (e) {
                alert('JSON 오류: ' + e.message);
            }
        }

        function resetSetData() {
            const setName = document.getElementById('set-selector').value;
            if (confirm(`'${setName}' 세트를 초기값으로 되돌리시겠습니까?\n\n예: 초기화 진행\n아니오: 취소`)) {
                goodStats[setName] = JSON.parse(JSON.stringify(originalGoodStats[setName]));
                loadSetData();
                alert('초기화 완료!');
                renderModules();
            }
        }

        function addModule() {
            modules.push({
                id: nextId++,
                set: '공세',
                slot: '마스크',
                mainStat: '깡공',
                matrix: 2,
                substatCount: 3,
                substats: {}
            });
            renderModules();
        }

        function removeModule(id) {
            modules = modules.filter(m => m.id !== id);
            renderModules();
        }

        function toggleSubstat(id, stat) {
            const module = modules.find(m => m.id === id);
            if (module) {
                const selected = Object.values(module.substats).filter(v => v).length;
                if (module.substats[stat]) {
                    module.substats[stat] = false;
                } else if (selected < module.substatCount) {
                    module.substats[stat] = true;
                }
                renderModules();
            }
        }

        function evaluateModule(module) {
            const selected = Object.keys(module.substats).filter(s => module.substats[s]);
            if (selected.length === 0) return { status: 'empty', text: '옵션 미선택' };
            
            let good = goodStats[module.set]?.[module.slot] || [];
            if (module.slot === '코어' && typeof good === 'object') {
                good = good[module.mainStat] || good['default'] || [];
            }
            
            const goodCount = selected.filter(s => good.includes(s)).length;
            
            if (module.substatCount === 4 && goodCount >= 3) return { status: 'keep', text: '보관' };
            if (module.substatCount === 3 && goodCount === 3) return { status: 'keep', text: '보관' };
            return { status: 'sell', text: '판매' };
        }

        function renderModules() {
            const container = document.getElementById('modules-container');
            if (modules.length === 0) {
                container.innerHTML = '<div class="empty-state">모듈을 추가하세요</div>';
                return;
            }
            
            container.innerHTML = modules.map(m => {
                const eval = evaluateModule(m);
                let good = goodStats[m.set]?.[m.slot] || [];
                if (m.slot === '코어' && typeof good === 'object') {
                    good = good[m.mainStat] || good['default'] || [];
                }
                
                const allStats = ['깡체', 'HP%', '깡공', '공격력%', '깡방', '방어력%', '속도', '치명타 확률', '치명타 피해', '효과 명중', '효과 저항'];
                
                return `
                    <div class="module-card ${eval.status}">
                        <div class="module-header">
                            <div class="module-info">
                                <div class="select-wrapper">
                                    <div class="select-label">세트</div>
                                    <select onchange="modules.find(x=>x.id===${m.id}).set=this.value; renderModules();">
                                        ${Object.keys(goodStats).map(s => `<option ${m.set===s?'selected':''}>${s}</option>`).join('')}
                                    </select>
                                </div>
                                <div class="select-wrapper">
                                    <div class="select-label">부위</div>
                                    <select onchange="modules.find(x=>x.id===${m.id}).slot=this.value; modules.find(x=>x.id===${m.id}).mainStat='깡공'; renderModules();">
                                        ${['마스크','트랜지스터','반지','코어'].map(s => `<option ${m.slot===s?'selected':''}>${s}</option>`).join('')}
                                    </select>
                                </div>
                                ${m.slot === '코어' ? `
                                <div class="select-wrapper">
                                    <div class="select-label">주옵션</div>
                                    <select onchange="modules.find(x=>x.id===${m.id}).mainStat=this.value; modules.find(x=>x.id===${m.id}).substats={}; renderModules();">
                                        ${['공격력%','방어력%','HP%','치명타 확률','치명타 피해','효과 명중','효과 저항'].map(s => `<option ${m.mainStat===s?'selected':''}>${s}</option>`).join('')}
                                    </select>
                                </div>
                                ` : ''}
                                <div class="select-wrapper">
                                    <div class="select-label">매트릭스</div>
                                    <select onchange="modules.find(x=>x.id===${m.id}).matrix=+this.value; renderModules();">
                                        <option ${m.matrix===2?'selected':''}>2</option>
                                        <option ${m.matrix===3?'selected':''}>3</option>
                                    </select>
                                </div>
                                <div class="select-wrapper">
                                    <div class="select-label">부가 능력치</div>
                                    <select onchange="modules.find(x=>x.id===${m.id}).substatCount=+this.value; modules.find(x=>x.id===${m.id}).substats={}; renderModules();">
                                        <option ${m.substatCount===3?'selected':''}>3</option>
                                        <option ${m.substatCount===4?'selected':''}>4</option>
                                    </select>
                                </div>
                                <div class="status-badge ${eval.status}">${eval.text}</div>
                            </div>
                            <button class="remove-btn" onclick="removeModule(${m.id})">삭제</button>
                        </div>
                        <div class="main-stat-info">
                            세트: ${m.set} | 부위: ${m.slot}${m.slot === '코어' ? ` | 주옵션: ${m.mainStat}` : ''}
                        </div>
                        <div class="substats-grid">
                            ${allStats.map(stat => {
                                const isGood = good.includes(stat);
                                const isSelected = m.substats[stat];
                                const selectedCount = Object.values(m.substats).filter(v=>v).length;
                                const isDisabled = !isSelected && selectedCount >= m.substatCount;
                                return `<button class="substat-btn ${isGood?'good':'bad'} ${isSelected?'selected':''}" 
                                        onclick="toggleSubstat(${m.id},'${stat}')" ${isDisabled?'disabled':''}>${stat}</button>`;
                            }).join('')}
                        </div>
                    </div>
                `;
            }).join('');
        }

        initEditor();
        renderModules();
    </script>
</body>
</html>
