<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>장비 옵션 테이블</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
            background: #f5f5f5;
            padding: 40px 20px;
            min-height: 100vh;
            color: #1a1a1a;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        h1 {
            text-align: center;
            color: #1a1a1a;
            margin-bottom: 40px;
            font-size: 2.2em;
            font-weight: 700;
            letter-spacing: -0.5px;
        }

        .grid-layout {
            display: grid;
            grid-template-columns: 1fr 350px;
            gap: 24px;
            margin-bottom: 30px;
        }

        .card {
            background: white;
            border-radius: 12px;
            padding: 32px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            border: 1px solid #e8e8e8;
        }

        .card h2 {
            color: #1a1a1a;
            margin-bottom: 24px;
            font-size: 1.6em;
            font-weight: 700;
            letter-spacing: -0.4px;
            padding-bottom: 12px;
            border-bottom: 2px solid #1a1a1a;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th {
            background: #f9f9f9;
            color: #333;
            padding: 14px 18px;
            text-align: left;
            font-weight: 700;
            font-size: 13px;
            border-bottom: 2px solid #e0e0e0;
            letter-spacing: 0.3px;
        }

        td {
            padding: 16px 18px;
            border-bottom: 1px solid #f0f0f0;
            font-size: 14.5px;
            color: #2a2a2a;
            line-height: 1.6;
        }

        tr:last-child td {
            border-bottom: none;
        }

        tbody tr:hover {
            background: #fafafa;
        }

        .equipment-name {
            font-weight: 700;
            font-size: 15px;
            color: #1a1a1a;
            min-width: 100px;
        }

        .color-badge {
            display: inline-block;
            padding: 5px 12px;
            border-radius: 6px;
            font-weight: 600;
            font-size: 12.5px;
            margin-right: 8px;
            letter-spacing: -0.2px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .color-badge:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.15);
        }

        .color-badge.active {
            box-shadow: 0 0 0 3px rgba(0,0,0,0.1);
            transform: scale(1.05);
        }

        .color-red { 
            background: #fee; 
            color: #c00; 
            border: 1px solid #fcc;
        }
        .color-blue { 
            background: #e3f2fd; 
            color: #1565c0; 
            border: 1px solid #bbdefb;
        }
        .color-yellow { 
            background: #fff9e6; 
            color: #b8860b; 
            border: 1px solid #ffe9a8;
        }
        .color-green { 
            background: #e8f5e9; 
            color: #2e7d32; 
            border: 1px solid #c8e6c9;
        }

        .section-divider {
            font-weight: 600;
            color: #666;
            margin: 0 6px;
        }

        /* 색상별 섹션 테이블 스타일 */
        .color-section-table td:first-child {
            font-weight: 600;
        }

        .color-section-table td {
            text-align: center;
            padding: 14px 12px;
        }

        .color-section-table td:first-child {
            text-align: left;
        }

        .color-section-table th {
            text-align: center;
            font-size: 12px;
        }

        .color-section-table th:first-child {
            text-align: left;
        }

        /* 색상 선택 버튼 */
        .color-selector {
            display: flex;
            gap: 12px;
            margin-bottom: 24px;
            flex-wrap: wrap;
        }

        .color-selector .color-badge {
            padding: 8px 16px;
            font-size: 14px;
        }

        /* 부옵션 상태 스타일 */
        .sub-option-item {
            display: inline-block;
            padding: 6px 14px;
            margin: 3px;
            border-radius: 6px;
            font-size: 15px;
            transition: all 0.3s;
            font-weight: 500;
            cursor: pointer;
            user-select: none;
        }

        .sub-option-item:hover {
            transform: translateY(-1px);
            box-shadow: 0 2px 6px rgba(0,0,0,0.15);
        }

        .sub-option-item:active {
            transform: translateY(0);
        }

        .sub-option-item.good {
            background: #e8f5e9;
            color: #2e7d32;
            border: 1px solid #c8e6c9;
            font-weight: 600;
        }

        .sub-option-item.bad {
            background: #ffebee;
            color: #c62828;
            border: 1px solid #ffcdd2;
            opacity: 0.7;
        }



        /* 반응형 */
        @media (max-width: 1200px) {
            .grid-layout {
                grid-template-columns: 1fr;
            }
        }

        /* 주요 부옵션 스타일 */
        .sub-options {
            color: #555;
            font-size: 13.5px;
            letter-spacing: 0.2px;
        }

        /* 옵션 분석기 스타일 */
        .option-analyzer {
            margin-top: 24px;
        }

        .main-option-select {
            margin-bottom: 20px;
        }

        .main-option-select label {
            display: block;
            font-weight: 600;
            margin-bottom: 8px;
            color: #1a1a1a;
        }

        .main-option-select select {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 15px;
            background: white;
            cursor: pointer;
            transition: border-color 0.2s;
        }

        .main-option-select select:focus {
            outline: none;
            border-color: #1a1a1a;
        }

        .sub-options-display {
            line-height: 2;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>가방 쿠와앙</h1>
        
        <div class="grid-layout">
            <!-- 장비 옵션 (좌측, 넓게) -->
            <div class="card">
                <h2>장비 옵션</h2>
                <table>
                    <thead>
                        <tr>
                            <th style="width: 110px;">장비</th>
                            <th style="width: 200px;">주요 부옵션</th>
                            <th>판매 옵션 (색상별)</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td class="equipment-name">마스크</td>
                            <td class="sub-options">치확 / 치피 / 공% / 속도<br>효명 / 깡방 / 깡체</td>
                            <td>
                                <span class="color-badge color-red">빨강</span> 깡방/깡체
                                <span class="section-divider">|</span>
                                <span class="color-badge color-blue">파랑</span> 깡방/깡체/속X
                                <span class="section-divider">|</span>
                                <span class="color-badge color-yellow">노랑</span> 공%
                                <span class="section-divider">|</span>
                                <span class="color-badge color-green">초록</span> 깡공
                            </td>
                        </tr>
                        <tr>
                            <td class="equipment-name">트랜지스터</td>
                            <td class="sub-options">치확 / 치피 / 속도 / 체%<br>깡방 / 효저 / 깡공</td>
                            <td>
                                <span class="color-badge color-red">빨강</span> 효저/깡방
                                <span class="section-divider">|</span>
                                <span class="color-badge color-blue">파랑</span> 효저/깡공/속X
                                <span class="section-divider">|</span>
                                <span class="color-badge color-yellow">노랑</span> 깡공
                                <span class="section-divider">|</span>
                                <span class="color-badge color-green">초록</span> 깡공/치피
                            </td>
                        </tr>
                        <tr>
                            <td class="equipment-name">리스트</td>
                            <td class="sub-options">치확 / 치피 / 속도 / 방%<br>깡체 / 효저 / 깡공</td>
                            <td>
                                <span class="color-badge color-red">빨강</span> 효저/깡공
                                <span class="section-divider">|</span>
                                <span class="color-badge color-blue">파랑</span> 효저/깡공/속X
                                <span class="section-divider">|</span>
                                <span class="color-badge color-yellow">노랑</span> 깡공
                                <span class="section-divider">|</span>
                                <span class="color-badge color-green">초록</span> 깡공
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <!-- 색상별 섹션 (우측 상단) -->
            <div class="card">
                <h2>색상별 섹션</h2>
                <table class="color-section-table">
                    <thead>
                        <tr>
                            <th>색상</th>
                            <th></th>
                            <th></th>
                            <th></th>
                            <th></th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><span class="color-badge color-red">빨강</span></td>
                            <td>공세</td>
                            <td>처단</td>
                            <td>광폭</td>
                            <td>기세<br>추격</td>
                        </tr>
                        <tr>
                            <td><span class="color-badge color-blue">파랑</span></td>
                            <td>질주</td>
                            <td>수호</td>
                            <td>진격</td>
                            <td>시공<br>지배</td>
                        </tr>
                        <tr>
                            <td><span class="color-badge color-yellow">노랑</span></td>
                            <td>강철</td>
                            <td>악기</td>
                            <td>유혈</td>
                            <td>-</td>
                        </tr>
                        <tr>
                            <td><span class="color-badge color-green">초록</span></td>
                            <td>원천</td>
                            <td>치유</td>
                            <td>-</td>
                            <td>-</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- 오른쪽 모듈 (장비 옵션 아래) -->
        <div class="card">
            <h2>오른쪽 모듈</h2>
            
            <div class="color-selector">
                <span class="color-badge color-red" data-color="red">빨강</span>
                <span class="color-badge color-blue" data-color="blue">파랑</span>
                <span class="color-badge color-yellow" data-color="yellow">노랑</span>
                <span class="color-badge color-green" data-color="green">초록</span>
            </div>

            <div class="option-analyzer">
                <div class="main-option-select">
                    <label>주 옵션 선택</label>
                    <select id="mainOptionSelect">
                        <option value="">선택하세요</option>
                        <option value="HP%">HP%</option>
                        <option value="치명타 확률">치명타 확률</option>
                        <option value="치명타 피해">치명타 피해</option>
                        <option value="공%">공%</option>
                        <option value="방%">방%</option>
                        <option value="효과 명중">효과 명중</option>
                        <option value="효과 저항">효과 저항</option>
                        <option value="깡체">깡체</option>
                    </select>
                </div>

                <div class="sub-options-display" id="subOptionsDisplay">
                    색상과 주 옵션을 선택하세요
                </div>
            </div>
        </div>


    </div>

    <script>
        // JSONBin.io 설정
        const JSONBIN_BIN_ID = '6922f96aae596e708f6b9402';
        const JSONBIN_API_KEY = '$2a$10$zDafvaVaEGF1Ybm2gCeEE.ZxR17ccQ4WYGDxm6W/5WDj1c8lL//Nq';
        const JSONBIN_URL = `https://api.jsonbin.io/v3/b/${JSONBIN_BIN_ID}`;

        // 주 옵션별 부옵션 데이터
        const mainOptionData = {
            'HP%': ['깡체', '공%', '깡공', '방%', '깡방', '치명타 확률', '치명타 피해', '효과 명중', '효과 저항', '공속'],
            '치명타 확률': ['HP%', '깡체', '공%', '깡공', '방%', '깡방', '치명타 피해', '효과 명중', '효과 저항', '공속'],
            '치명타 피해': ['HP%', '깡체', '공%', '깡공', '방%', '깡방', '치명타 확률', '효과 명중', '효과 저항', '공속'],
            '공%': ['HP%', '깡체', '깡공', '방%', '깡방', '치명타 확률', '치명타 피해', '효과 명중', '효과 저항', '공속'],
            '방%': ['HP%', '깡체', '공%', '깡공', '깡방', '치명타 확률', '치명타 피해', '효과 명중', '효과 저항', '공속'],
            '효과 명중': ['HP%', '깡체', '공%', '깡공', '방%', '깡방', '치명타 확률', '치명타 피해', '효과 저항', '공속'],
            '효과 저항': ['HP%', '깡체', '공%', '깡공', '방%', '깡방', '치명타 확률', '치명타 피해', '효과 명중', '공속'],
            '깡체': ['HP%', '공%', '깡공', '방%', '깡방', '치명타 확률', '치명타 피해', '효과 명중', '효과 저항', '공속']
        };

        // 주 옵션별 유효 옵션 정의 (색상 무관) - 사용 안 함
        // const mainOptionValidOptions = {
        //     'HP%': ['깡체', '치명타 확률', '치명타 피해', '효과 명중', '효과 저항', '공속', '방%']
        // };

        // 색상별 좋은 옵션 정의 (기본값)
        const defaultColorGoodOptions = {
            'red': {
                'HP%': ['치명타 확률', '치명타 피해', '공속'],
                '치명타 확률': ['HP%', '치명타 피해', '공%', '깡공', '공속'],
                '치명타 피해': ['HP%', '치명타 확률', '공%', '깡공', '공속'],
                '공%': ['치명타 확률', '치명타 피해', '깡공', '공속'],
                '방%': ['깡체', '깡방'],
                '효과 명중': ['공%', '깡공', '공속'],
                '효과 저항': ['HP%', '깡체', '방%', '깡방'],
                '깡체': ['HP%', '방%', '깡방']
            },
            'blue': {
                'HP%': ['깡체', '방%', '효과 저항'],
                '치명타 확률': ['HP%', '깡체', '방%', '깡방', '효과 저항'],
                '치명타 피해': ['HP%', '깡체', '방%', '깡방', '효과 저항'],
                '공%': ['HP%', '깡체', '방%', '깡방', '효과 저항'],
                '방%': ['HP%', '깡체', '깡방', '효과 저항'],
                '효과 명중': ['HP%', '깡체', '방%', '깡방', '효과 저항'],
                '효과 저항': ['HP%', '깡체', '방%', '깡방'],
                '깡체': ['HP%', '방%', '깡방', '효과 저항']
            },
            'yellow': {
                'HP%': ['깡체', '방%'],
                '치명타 확률': ['HP%', '깡체', '방%', '깡방'],
                '치명타 피해': ['HP%', '깡체', '방%', '깡방'],
                '공%': ['HP%', '깡체', '방%', '깡방'],
                '방%': ['HP%', '깡체', '깡방'],
                '효과 명중': ['HP%', '깡체', '방%', '깡방'],
                '효과 저항': ['HP%', '깡체', '방%', '깡방'],
                '깡체': ['HP%', '방%', '깡방']
            },
            'green': {
                'HP%': ['효과 명중', '효과 저항'],
                '치명타 확률': ['HP%', '효과 명중', '효과 저항'],
                '치명타 피해': ['HP%', '효과 명중', '효과 저항'],
                '공%': ['효과 명중', '효과 저항'],
                '방%': ['HP%', '깡체', '효과 명중', '효과 저항'],
                '효과 명중': ['HP%', '공%', '깡공', '효과 저항', '공속'],
                '효과 저항': ['HP%', '깡체', '방%', '깡방', '효과 명중'],
                '깡체': ['HP%', '방%', '효과 명중', '효과 저항']
            }
        };

        let selectedColor = null;
        let selectedMainOption = null;
        let customColorOptions = {}; // 사용자 정의 색상별 옵션
        let pollInterval = null; // 폴링 인터벌

        // 페이지 로드 시 저장된 설정 불러오기
        async function loadCustomOptions() {
            try {
                const response = await fetch(`${JSONBIN_URL}/latest`, {
                    method: 'GET',
                    headers: {
                        'X-Master-Key': JSONBIN_API_KEY
                    }
                });

                if (response.ok) {
                    const result = await response.json();
                    customColorOptions = result.record;
                    localStorage.setItem('custom-color-options', JSON.stringify(customColorOptions));
                } else {
                    const savedData = localStorage.getItem('custom-color-options');
                    if (savedData) {
                        customColorOptions = JSON.parse(savedData);
                    } else {
                        customColorOptions = JSON.parse(JSON.stringify(defaultColorGoodOptions));
                    }
                }
            } catch (error) {
                const savedData = localStorage.getItem('custom-color-options');
                if (savedData) {
                    customColorOptions = JSON.parse(savedData);
                } else {
                    customColorOptions = JSON.parse(JSON.stringify(defaultColorGoodOptions));
                }
            }
            updateSubOptions();
        }

        // 주기적으로 변경사항 확인
        function startPolling() {
            if (pollInterval) clearInterval(pollInterval);
            
            pollInterval = setInterval(async () => {
                try {
                    const response = await fetch(`${JSONBIN_URL}/latest`, {
                        method: 'GET',
                        headers: {
                            'X-Master-Key': JSONBIN_API_KEY
                        }
                    });

                    if (response.ok) {
                        const result = await response.json();
                        const newOptions = result.record;
                        
                        if (JSON.stringify(newOptions) !== JSON.stringify(customColorOptions)) {
                            customColorOptions = newOptions;
                            updateSubOptions();
                            localStorage.setItem('custom-color-options', JSON.stringify(customColorOptions));
                        }
                    }
                } catch (error) {
                    // 네트워크 에러 무시
                }
            }, 10000);
        }

        // 커스텀 옵션 저장
        async function saveCustomOptions() {
            try {
                const response = await fetch(JSONBIN_URL, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-Master-Key': JSONBIN_API_KEY
                    },
                    body: JSON.stringify(customColorOptions)
                });

                if (response.ok) {
                    localStorage.setItem('custom-color-options', JSON.stringify(customColorOptions));
                    return true;
                }
                return false;
            } catch (error) {
                console.error('저장 실패:', error);
                return false;
            }
        }

        // 현재 색상별 좋은 옵션 가져오기
        function getColorGoodOptions(color) {
            if (customColorOptions[color] && customColorOptions[color][selectedMainOption]) {
                return customColorOptions[color][selectedMainOption];
            }
            if (defaultColorGoodOptions[color] && defaultColorGoodOptions[color][selectedMainOption]) {
                return defaultColorGoodOptions[color][selectedMainOption];
            }
            return [];
        }

        // 색상 선택 이벤트
        document.querySelectorAll('.color-badge').forEach(badge => {
            badge.addEventListener('click', function() {
                const color = this.getAttribute('data-color');
                if (!color) return;

                // 활성화 상태 토글
                document.querySelectorAll('.color-badge[data-color]').forEach(b => {
                    b.classList.remove('active');
                });
                this.classList.add('active');
                
                selectedColor = color;
                updateSubOptions();
            });
        });

        // 주 옵션 선택 이벤트
        document.getElementById('mainOptionSelect').addEventListener('change', function() {
            selectedMainOption = this.value;
            updateSubOptions();
        });

        // 부옵션 클릭 이벤트
        function toggleOption(optionName) {
            if (!selectedColor || !selectedMainOption) return;

            if (!customColorOptions[selectedColor]) {
                customColorOptions[selectedColor] = {};
            }
            
            if (!customColorOptions[selectedColor][selectedMainOption]) {
                if (defaultColorGoodOptions[selectedColor] && defaultColorGoodOptions[selectedColor][selectedMainOption]) {
                    customColorOptions[selectedColor][selectedMainOption] = [...defaultColorGoodOptions[selectedColor][selectedMainOption]];
                } else {
                    customColorOptions[selectedColor][selectedMainOption] = [];
                }
            }

            const currentOptions = customColorOptions[selectedColor][selectedMainOption];
            const index = currentOptions.indexOf(optionName);

            if (index > -1) {
                currentOptions.splice(index, 1);
            } else {
                currentOptions.push(optionName);
            }

            updateSubOptions();
            saveCustomOptions();
        }

        // 부옵션 표시 업데이트
        function updateSubOptions() {
            const display = document.getElementById('subOptionsDisplay');
            
            if (!selectedColor) {
                display.innerHTML = '색상을 선택하세요';
                return;
            }
            
            if (!selectedMainOption) {
                display.innerHTML = '주 옵션을 선택하세요';
                return;
            }

            const subOptions = mainOptionData[selectedMainOption];
            const goodOptions = getColorGoodOptions(selectedColor);
            let html = '';
            
            subOptions.forEach(option => {
                const cssClass = goodOptions.includes(option) ? 'good' : 'bad';
                html += `<span class="sub-option-item ${cssClass}" onclick="toggleOption('${option}')">${option}</span>`;
            });

            display.innerHTML = html;
        }

        loadCustomOptions().then(() => {
            startPolling();
        });
    </script>
</body>
</html>
